name = "hypegit"
main = "src/index.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]

# D1 Database
[[d1_databases]]
binding = "HYPEGIT_DB"
database_name = "hypegit-repos"
database_id = "0ef96cf8-432c-4dee-a0ab-43c560ab3492"
migrations_dir = "prisma/migrations"

# R2 Bucket
[[r2_buckets]]
binding = "HYPEGIT_BUCKET"
bucket_name = "hypegit-snapshots"

# Environment variables
[vars]
ENVIRONMENT = "production"

# Cron triggers
[triggers]
crons = ["22 9 * * *"]  # Daily at 9:22 AM UTC (6:22 PM KST)

# Queues - Producer binding (for cron to send messages)
[[queues.producers]]
queue = "hypegit-scraper-queue"
binding = "SCRAPER_QUEUE"

# Queues - Consumer configuration (for processing messages)
[[queues.consumers]]
queue = "hypegit-scraper-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 5
dead_letter_queue = "hypegit-scraper-dlq"
# max_concurrency not set = unlimited auto-scaling (up to 250)

# Development environment
[env.development]
vars = { ENVIRONMENT = "development" }

# wrangler.toml (wrangler v3.88.0^)
[observability]
enabled = true

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
